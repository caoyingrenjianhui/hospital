<!DOCTYPE html>
<html lang="zxx">
<head>
    <title>登录</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8"/>
    <meta name="keywords" content=""/>
    <script>
        addEventListener("load", function () {
            setTimeout(hideURLbar, 0);
        }, false);

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>
    <link href="../css/bootstrap.css" type="text/css" rel="stylesheet" media="all">
    <link href="../css/style.css" type="text/css" rel="stylesheet" media="all">
    <link href="../css/fontawesome-all.min.css" rel="stylesheet">
    <link href="../css/minimal-slider.css" rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="../css/flexslider.css" type="text/css" media="screen" property=""/>
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:200,300,400,500,600,700,800,900" rel="stylesheet">
    <script src="../js/vue.js"></script>
    <script src="../element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="../element-ui/lib/theme-chalk/index.css">
    <script src="../js/axios-0.18.0.js"></script>
</head>
<body style="background-image: url(../images/bg1.jpg)">

<!-- login  -->
<div style="margin-top: 100px" id="exampleModal">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">登录</h5>
                <a href="index.html" type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </a>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="col-form-label">身份证号</label>
                    <input type="text" class="form-control" v-model="user.userID" placeholder=" " name="Name"
                           id="recipient-name"
                           required="">
                </div>
                <div class="form-group">
                    <label class="col-form-label">密码</label>
                    <input type="password" class="form-control" v-model="user.password" placeholder=" " name="Password"
                           id="password"
                           required="">
                </div>
                <div class="right-w3l">
                    <input @click="login()" type="submit" class="form-control" value="登录">
                </div>
                <div class="row sub-w3l my-3">
                    <div class="col forgot-w3l text-right">
                        <a href="#" data-toggle="modal" data-target="#exampleModalCenter3"
                           class="text-secondary">
                            忘记密码</a>
                    </div>
                </div>
                <p class="text-center dont-do">没有账户？
                    <a href="#" data-toggle="modal" data-target="#exampleModalCenter2"
                       class="text-dark font-weight-bold">
                        立即注册</a>

                </p>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="exampleModalCenter2" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="login px-4 mx-auto mw-100">
                    <h5 class="modal-title text-center text-dark mb-4">立即注册</h5>
                    <div class="form-group">
                        <label class="col-form-label">姓名</label>
                        <input type="text" class="form-control" v-model="user.username" placeholder="" required="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">邮箱</label>
                        <input type="text" class="form-control" v-model="user.email" placeholder="" required="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">手机号</label>
                        <input type="text" class="form-control" v-model="user.phone" placeholder="" required="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">住址</label>
                        <input type="text" class="form-control" v-model="user.address" placeholder="" required="">
                    </div>

                    <div class="form-group">
                        <label class="mb-2 col-form-label">密码</label>
                        <input type="password" class="form-control" v-model="user.password"
                               placeholder=""
                               required="">
                    </div>
                    <div class="form-group">
                        <label class="col-form-label">确定密码</label>
                        <input type="password" class="form-control" v-model="user.rePassword" placeholder=""
                               required="">
                    </div>
                    <div class="reg-w3l">
                        <button @click="addUser()" class="form-control submit mb-4">注册</button>
                    </div>

                </div>

            </div>

        </div>
    </div>
</div>
<div class="modal fade" id="exampleModalCenter3" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" >重置密码</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="col-form-label">身份证号</label>
                    <input type="text" class="form-control" v-model="user.userID" placeholder=" " name="Name"
                           required="">
                </div>
                <div class="form-group">
                    <label class="col-form-label">手机号</label>
                    <input type="password" class="form-control" v-model="user.phone" placeholder=" " name="Password"
                           required="">
                </div>
                <div class="right-w3l">
                    <input @click="reset()" type="submit" class="form-control" value="立即重置">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="../js/jquery-2.2.3.min.js"></script>
<script src="../js/minimal-slider.js"></script>
<link rel="stylesheet" href="../css/jquery-ui.css"/>
<script src="../js/jquery-ui.js"></script>

<script defer src="../js/jquery.flexslider.js"></script>

<script src="../js/move-top.js"></script>
<script src="../js/easing.js"></script>
<script src="../js/SmoothScroll.min.js"></script>

<script src="../js/bootstrap.js"></script>
<script src="../js/axios-0.18.0.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="../js/vue.js"></script>

<script>
    new Vue({
        el: "#exampleModal",
        data() {
            return {
                user: {
                    userID: '',
                    username: '',
                    password: '',
                    phone: '',
                    email: '',
                    address: '',
                    userType: '',
                    photo: '',
                    rePassword: '',
                    token:''
                },
            }
        },
        methods: {
            /*登录按钮的方法*/
            login() {
                if (this.user.userID.length == 0) {
                    alert("请输入您的身份证号")
                } else if (this.user.password.length == 0) {
                    alert("请输入您的密码")
                } else {
                    axios.post("/user/login", this.user).then((res) => {
                        if (res.data.code == 20041) {
                            console.log("成功")
                            this.user = res.data.data
                            sessionStorage.setItem("password", this.user.password)
                            sessionStorage.setItem("name", this.user.username)
                            sessionStorage.setItem("token", this.user.token)
                            sessionStorage.setItem("userType",this.user.userType)
                            sessionStorage.setItem("userID",this.user.userID)
                            location.href = "index.html"
                            if (this.user.userType == 0) {
                                //如果是管理员
                                console.log("患者")
                                // location.href = "ad_about.html"
                            } else if (this.user.userType == 1) {
                                console.log("医生")
                                // location.href = "doctor.html"
                            } else if (this.user.userType == 2) {
                                console.log("管理员")
                                // location.href = "doctor.html"
                            }
                        } else if (res.data.code == 20040) {
                            alert(res.data.msg);
                        }
                    })
                }

            },
        }
    })
    new Vue({
        el: "#exampleModalCenter2",
        data() {
            return {
                user: {
                    userID: '',
                    username: '',
                    password: '',
                    phone: '',
                    email: '',
                    address: '',
                    userType: '',
                    photo: '',
                    rePassword: ''
                },
                name: "",
            }
        },
        methods: {
            /*注册按钮的方法*/
            addUser() {
                //将名字和密码存入sessionStorage中
                sessionStorage.setItem("password", this.password)
                sessionStorage.setItem("name", this.name);
                //调用存储
                if (this.user != null) {
                    if (this.user.username.length == 0) {
                        alert("请您输入您的姓名！")
                    } else if (this.user.password.length == 0) {
                        alert("请您输入密码！")
                    } else {
                        axios.post("/user/register", this.user).then((res) => {
                            if (res.data.code == 20011) {
                                //将输入框清空
                                this.name = "";
                                this.password = "";
                                alert(res.data.msg);
                                location.href = "login.html"
                            } else {
                                alert(res.data.msg);
                            }
                        })
                    }
                }
            }
        }
    })
    new Vue({
        el: "#exampleModalCenter3",
        data() {
            return {
                user: {
                    userID: '',
                    username: '',
                    password: '',
                    phone: '',
                    email: '',
                    address: '',
                    userType: '',
                    photo: '',
                    rePassword: ''
                },
                name: "",
            }
        },
        methods: {
            beforeDestroy() {
                // 移除页面关闭事件监听器，防止内存泄漏
                window.removeEventListener('beforeunload', this.clearsessionStorage);
            },
            clearsessionStorage() {
                sessionStorage.clear()
            },
            /*重置按钮按钮的方法*/
            reset() {
                if (this.user != null) {
                    if (this.user.userID.length == 0) {
                        alert("请您输入您的身份证号！")
                    } else if (this.user.phone.length == 0) {
                        alert("请您输入手机号！")
                    } else {
                        axios.post("/user/reset", this.user).then((res) => {
                            if (res.data.code == 20031) {
                                //将输入框清空
                                this.name = "";
                                this.password = "";
                                alert(res.data.msg);
                                location.href = "login.html"
                            } else {
                                alert(res.data.msg);
                            }
                        })
                    }
                }
            }
        },
        mounted: function () {
            // window.addEventListener('beforeunload', this.clearsessionStorage);
        }
    })
</script>
</body>
</html>